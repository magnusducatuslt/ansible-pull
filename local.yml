---
- hosts: magnusducatuslts-MacBook-Pro.local
  connection: local 
  gather_facts: false
  vars:

    # schedule is fed directly to cron
    schedule: '* * * * *'

    # User to run ansible-pull as from cron
    cron_user: root

    # File that ansible will use for logs
    logfile: /Users/magnusducatuslt/spatium/ansible-pull

    # Directory to where repository will be cloned
    workdir: /Users/magnusducatuslt/spatium/ansible-pull

    repo_url: git@github.com:magnusducatuslt/ansible-pull.git
  tasks:
    - include_tasks: tasks/cron.yaml

    - name: "Execute"
      shell: "echo 1"
      register: output
    - debug: var=output.stdout_lines

    - name: Tear down existing services
      community.docker.docker_compose:
        project_src: "./"
        state: absent
      register: "output"
      when: "'{{gitresult.before}}' != '{{gitresult.after}}'"

    - name: Create and start services
      community.docker.docker_compose:
        project_src: ./
      register: output
    